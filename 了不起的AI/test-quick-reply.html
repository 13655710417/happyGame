<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿå›å¤åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        .test-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #666;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .test-title i {
            color: #FF69B4;
        }
        .test-button {
            background: linear-gradient(135deg, #FF69B4, #FFB6C1);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        .test-button:hover {
            transform: translateY(-2px);
        }
        .test-result {
            margin-top: 20px;
            padding: 15px;
            background: #FFF8E1;
            border: 2px dashed #FFD54F;
            border-radius: 6px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .quick-reply-test {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .quick-reply-card {
            padding: 15px;
            background: #FFE4E9;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .quick-reply-card:hover {
            transform: translateY(-3px);
            background: #FFD1DC;
        }
        .quick-reply-text {
            font-weight: bold;
            color: #FF69B4;
            margin-bottom: 5px;
        }
        .quick-reply-label {
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>å¿«é€Ÿå›å¤åŠŸèƒ½æµ‹è¯•</h1>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-comment"></i>
                NLPæ„å›¾è¯†åˆ«æµ‹è¯•
            </div>
            <p>æµ‹è¯•æ¶ˆæ¯çš„æ„å›¾è¯†åˆ«ï¼š</p>
            <button class="test-button" onclick="testIntent('æˆ‘éœ€è¦ä¸€äº›é¼“åŠ±')">æµ‹è¯•ï¼šæˆ‘éœ€è¦ä¸€äº›é¼“åŠ±</button>
            <button class="test-button" onclick="testIntent('è®²ä¸ªç¬‘è¯å§')">æµ‹è¯•ï¼šè®²ä¸ªç¬‘è¯å§</button>
            <button class="test-button" onclick="testIntent('ä»Šå¤©å¿ƒæƒ…ä¸å¤ªå¥½...')">æµ‹è¯•ï¼šä»Šå¤©å¿ƒæƒ…ä¸å¤ªå¥½...</button>
            <button class="test-button" onclick="testIntent('æœ‰ä»€ä¹ˆå¼€å¿ƒçš„äº‹åˆ†äº«å—ï¼Ÿ')">æµ‹è¯•ï¼šæœ‰ä»€ä¹ˆå¼€å¿ƒçš„äº‹åˆ†äº«å—ï¼Ÿ</button>
            <div class="test-result" id="intentResult"></div>
        </div>

        <div class="test-section">
            <div class="test-title">
                <i class="fas fa-reply"></i>
                å›å¤ç”Ÿæˆæµ‹è¯•
            </div>
            <p>æµ‹è¯•å¿«é€Ÿå›å¤æŒ‰é’®çš„æ¶ˆæ¯ï¼š</p>
            <div class="quick-reply-test">
                <div class="quick-reply-card" onclick="testResponse('ä»Šå¤©å¿ƒæƒ…ä¸å¤ªå¥½...', 'å¿ƒæƒ…å€¾è¯‰')">
                    <div class="quick-reply-text">ä»Šå¤©å¿ƒæƒ…ä¸å¤ªå¥½...</div>
                    <div class="quick-reply-label">å¿ƒæƒ…å€¾è¯‰</div>
                </div>
                <div class="quick-reply-card" onclick="testResponse('æœ‰ä»€ä¹ˆå¼€å¿ƒçš„äº‹åˆ†äº«å—ï¼Ÿ', 'åˆ†äº«å¿«ä¹')">
                    <div class="quick-reply-text">æœ‰ä»€ä¹ˆå¼€å¿ƒçš„äº‹åˆ†äº«å—ï¼Ÿ</div>
                    <div class="quick-reply-label">åˆ†äº«å¿«ä¹</div>
                </div>
                <div class="quick-reply-card" onclick="testResponse('æˆ‘éœ€è¦ä¸€äº›é¼“åŠ±', 'éœ€è¦é¼“åŠ±')">
                    <div class="quick-reply-text">æˆ‘éœ€è¦ä¸€äº›é¼“åŠ±</div>
                    <div class="quick-reply-label">éœ€è¦é¼“åŠ±</div>
                </div>
                <div class="quick-reply-card" onclick="testResponse('è®²ä¸ªç¬‘è¯å§', 'è®²ä¸ªç¬‘è¯')">
                    <div class="quick-reply-text">è®²ä¸ªç¬‘è¯å§</div>
                    <div class="quick-reply-label">è®²ä¸ªç¬‘è¯</div>
                </div>
                <div class="quick-reply-card" onclick="testResponse('å‘¨æ°ä¼¦æœ‰å“ªäº›æˆå°±ï¼Ÿ', 'å‘¨æ°ä¼¦çš„æˆå°±')">
                    <div class="quick-reply-text">å‘¨æ°ä¼¦æœ‰å“ªäº›æˆå°±ï¼Ÿ</div>
                    <div class="quick-reply-label">å‘¨æ°ä¼¦çš„æˆå°±</div>
                </div>
                <div class="quick-reply-card" onclick="testResponse('ç‹æ¥šé’¦ä¹’ä¹“çƒæ‰“å¾—æ€ä¹ˆæ ·ï¼Ÿ', 'ç‹æ¥šé’¦ä¹’ä¹“çƒ')">
                    <div class="quick-reply-text">ç‹æ¥šé’¦ä¹’ä¹“çƒæ‰“å¾—æ€ä¹ˆæ ·ï¼Ÿ</div>
                    <div class="quick-reply-label">ç‹æ¥šé’¦ä¹’ä¹“çƒ</div>
                </div>
            </div>
            <div class="test-result" id="responseResult"></div>
        </div>
    </div>

    <script src="nlp-module.js"></script>
    <script src="celebrity-knowledge.js"></script>
    <script>
        // åˆ›å»ºNLPæ¨¡å—å®ä¾‹
        const nlp = new SmartNLPModule();
        const celebrityManager = new CelebrityKnowledge();

        // æ¨¡æ‹ŸgetResponseTemplateså‡½æ•°
        function getResponseTemplates(intent, emotion = 'neutral') {
            const templates = {
                greeting: [
                    `ä½ å¥½å‘€ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼ğŸ˜Š`,
                    "å—¨ï½ä»Šå¤©è¿‡å¾—æ€ä¹ˆæ ·ï¼ŸğŸŒ¸",
                    "ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„AIä¼™ä¼´ï¼Œéšæ—¶ä¸ºä½ æœåŠ¡ï¼âœ¨"
                ],
                farewell: [
                    "å†è§å•¦ï½æœŸå¾…ä¸‹æ¬¡èŠå¤©ï¼ğŸ’•",
                    "æ‹œæ‹œï¼è®°å¾—ç…§é¡¾å¥½è‡ªå·±å“¦ï½ğŸŒ¸",
                    "æ™šå®‰ï¼Œæ„¿ä½ æœ‰ä¸ªå¥½æ¢¦ï¼ğŸŒ™"
                ],
                question: [
                    "è¿™ä¸ªé—®é¢˜å¾ˆæœ‰è¶£å‘¢ï¼è®©æˆ‘æƒ³æƒ³...ğŸ¤”",
                    "æˆ‘æ¥å¸®ä½ è§£ç­”è¿™ä¸ªé—®é¢˜ï¼ğŸ’¡",
                    "è¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œè®©æˆ‘æ€è€ƒä¸€ä¸‹ã€‚ğŸ’­"
                ],
                emotion: {
                    happy: [
                        "çœ‹åˆ°ä½ å¼€å¿ƒï¼Œæˆ‘ä¹Ÿæ„Ÿåˆ°å¿«ä¹ï¼ğŸ˜Š",
                        "çœŸä¸ºä½ æ„Ÿåˆ°é«˜å…´ï¼æ„¿è¿™ä»½å¿«ä¹ä¸€ç›´é™ªä¼´ä½ ã€‚âœ¨",
                        "å¿«ä¹æ˜¯ä¼šä¼ æŸ“çš„ï¼Œè°¢è°¢ä½ åˆ†äº«è¿™ä»½å–œæ‚¦ï¼ğŸ’–"
                    ],
                    sad: [
                        "æŠ±æŠ±ä½ ï½æˆ‘åœ¨è¿™é‡Œé™ªç€ä½ ã€‚ğŸ«‚",
                        "éš¾è¿‡çš„æ—¶å€™ï¼Œæœ‰äººå€¾è¯‰ä¼šå¥½ä¸€äº›ã€‚ğŸ’•",
                        "æˆ‘ç†è§£ä½ çš„æ„Ÿå—ï¼Œæƒ³è¯´ä»€ä¹ˆéƒ½å¯ä»¥ã€‚ğŸŒ¸"
                    ]
                },
                request: [
                    "å¥½çš„ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©ä½ ï¼ğŸ’ª",
                    "æ²¡é—®é¢˜ï¼Œæˆ‘æ¥å¸®ä½ ï¼âœ¨",
                    "æˆ‘å¾ˆä¹æ„ä¸ºä½ æä¾›å¸®åŠ©ï¼ğŸŒ¸"
                ],
                joke: [
                    "ä¸ºä»€ä¹ˆæ•°å­¦ä¹¦æ€»æ˜¯å¾ˆæ‚²ä¼¤ï¼Ÿå› ä¸ºå®ƒæœ‰å¤ªå¤šé—®é¢˜ï¼ğŸ˜‚",
                    "ä»€ä¹ˆåŠ¨ç‰©æœ€å®¹æ˜“æ‘”è·¤ï¼Ÿç‹ç‹¸ï¼Œå› ä¸ºç‹ç‹¸ç‹¡çŒ¾ï¼ˆè„šæ»‘ï¼‰ï¼ğŸ¦Š",
                    "ä¸ºä»€ä¹ˆç”µè„‘æ°¸è¿œä¸ä¼šæ„Ÿå†’ï¼Ÿå› ä¸ºå®ƒæœ‰Windowsï¼ˆçª—æˆ·ï¼‰ï¼ğŸ’»",
                    "ä»€ä¹ˆé±¼æœ€èªæ˜ï¼Ÿé‡‘é±¼ï¼Œå› ä¸ºå®ƒçš„è®°å¿†åªæœ‰7ç§’ï¼Œæ‰€ä»¥æ€»æ˜¯æ´»åœ¨å½“ä¸‹ï¼ğŸ ",
                    "ä¸ºä»€ä¹ˆé¦™è•‰ä¸ä¼šæ‰“ç”µè¯ï¼Ÿå› ä¸ºå®ƒæ²¡æœ‰ä¿¡å·ï¼ğŸ“ğŸŒ"
                ],
                encouragement: [
                    "ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ˜¯æœ€æ£’çš„ï¼ğŸ’ª",
                    "æ— è®ºé‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Œéƒ½è¦åšæŒä¸‹å»ï¼Œä½ ä¸€å®šå¯ä»¥ï¼âœ¨",
                    "æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œæœªæ¥ä¼šæœ‰å¤§ä¸åŒï¼ğŸŒŸ",
                    "ä½ å·²ç»åšå¾—å¾ˆå¥½äº†ï¼Œç»§ç»­åŠ æ²¹ï¼ğŸ’–",
                    "ä¸è¦å®³æ€•å¤±è´¥ï¼Œæ¯ä¸€æ¬¡å°è¯•éƒ½æ˜¯æˆé•¿çš„æœºä¼šï¼ğŸŒ¸"
                ],
                default: [
                    "æˆ‘åœ¨è¿™é‡Œè®¤çœŸå€¾å¬ä½ å‘¢ã€‚ğŸ’•",
                    "è°¢è°¢ä½ çš„åˆ†äº«ï¼âœ¨",
                    "æ— è®ºä½ æƒ³è¯´ä»€ä¹ˆï¼Œæˆ‘éƒ½ä¼šç”¨å¿ƒå›åº”ã€‚ğŸŒ¸"
                ]
            };

            if (intent === 'emotion' && templates.emotion[emotion]) {
                return templates.emotion[emotion];
            }

            return templates[intent] || templates.default;
        }

        // æ¨¡æ‹ŸgenerateRuleBasedResponseå‡½æ•°
        function generateRuleBasedResponse(intentScores, emotion = 'neutral') {
            // è·å–ä¸»è¦æ„å›¾
            const mainIntent = Object.keys(intentScores).reduce((a, b) => intentScores[a] > intentScores[b] ? a : b);

            // æ ¹æ®æ„å›¾é€‰æ‹©å›å¤æ¨¡æ¿
            const templates = getResponseTemplates(mainIntent, emotion);
            const template = templates[Math.floor(Math.random() * templates.length)];

            return template;
        }

        // æµ‹è¯•æ„å›¾è¯†åˆ«
        async function testIntent(message) {
            const resultContainer = document.getElementById('intentResult');

            // ä½¿ç”¨NLPæ¨¡å—åˆ†ææ¶ˆæ¯
            const analysis = await nlp.analyzeMessage(message);

            let result = `æ¶ˆæ¯ï¼š"${message}"\n\n`;
            result += `è¯†åˆ«åˆ°çš„æ„å›¾ï¼š\n`;

            // æŒ‰åˆ†æ•°æ’åº
            const sortedIntents = Object.entries(analysis.intent)
                .sort((a, b) => b[1] - a[1]);

            sortedIntents.forEach(([intent, score]) => {
                result += `  ${intent}: ${score.toFixed(2)}\n`;
            });

            result += `\nä¸»è¦æƒ…æ„Ÿï¼š${analysis.emotion.primary} (ç½®ä¿¡åº¦: ${analysis.emotion.confidence.toFixed(2)})`;

            resultContainer.innerHTML = result;
        }

        // æµ‹è¯•å›å¤ç”Ÿæˆ
        async function testResponse(message, label) {
            const resultContainer = document.getElementById('responseResult');

            // æ£€æŸ¥æ˜¯å¦æ˜¯æ˜æ˜Ÿç›¸å…³æ¶ˆæ¯
            const mentionedCelebrities = celebrityManager.detectCelebrityMention(message);

            if (mentionedCelebrities.length > 0) {
                // ä½¿ç”¨æ˜æ˜Ÿå›å¤
                const celebrityResponse = celebrityManager.generateCelebrityResponse(
                    mentionedCelebrities[0].id
                );
                resultContainer.innerHTML = `ğŸ“¢ æµ‹è¯•ï¼š${label}\nğŸ’¬ æ¶ˆæ¯ï¼š"${message}"\n\nğŸ­ æ£€æµ‹åˆ°æ˜æ˜Ÿï¼š${mentionedCelebrities[0].data.name}\n\nğŸ¤– AIå›å¤ï¼š\n${celebrityResponse}`;
                return;
            }

            // ä½¿ç”¨NLPåˆ†æ
            const analysis = await nlp.analyzeMessage(message);

            // ç”Ÿæˆå›å¤
            const response = generateRuleBasedResponse(analysis.intent, analysis.emotion.primary);

            resultContainer.innerHTML = `ğŸ“¢ æµ‹è¯•ï¼š${label}\nğŸ’¬ æ¶ˆæ¯ï¼š"${message}"\n\nğŸ¯ ä¸»è¦æ„å›¾ï¼š${Object.keys(analysis.intent).reduce((a, b) => analysis.intent[a] > analysis.intent[b] ? a : b)}\nğŸ˜Š æƒ…æ„Ÿï¼š${analysis.emotion.primary}\n\nğŸ¤– AIå›å¤ï¼š\n${response}`;
        }
    </script>
</body>
</html>